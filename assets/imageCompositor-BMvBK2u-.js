const k=async(H,b)=>{const{month:d,year:c,keyword:C,attitude:E}=b;return new Promise((T,B)=>{const i=document.createElement("canvas"),t=i.getContext("2d"),e=new Image;e.crossOrigin="Anonymous",e.src=H,e.onload=async()=>{i.width=1024,i.height=1365,t.fillStyle="#1a1a1a",t.fillRect(0,0,1024,1365);const F=Math.max(1024/e.width,1365/e.height),S=e.width*F,y=e.height*F,I=(1024-S)/2,U=(1365-y)/2;t.drawImage(e,I,U,S,y);const r=t.createLinearGradient(0,1365-450,0,1365);r.addColorStop(0,"rgba(0,0,0,0)"),r.addColorStop(.3,"rgba(0,0,0,0.1)"),r.addColorStop(.7,"rgba(0,0,0,0.6)"),r.addColorStop(1,"rgba(0,0,0,0.9)"),t.fillStyle=r,t.save();const s=i.width*.25,A=logoImg.height*(s/logoImg.width),u=(i.width-s)/2,W=60;t.shadowColor="rgba(0,0,0,0.5)",t.shadowBlur=10,t.drawImage(logoImg,u,W,s,A),t.restore(),t.shadowColor="rgba(0,0,0,0.8)",t.shadowBlur=15,t.shadowOffsetY=5;const h=W+A/2;t.textAlign="left",t.fillStyle="#FFFFFF",t.textBaseline="middle",t.font=`${35.84}px "Playfair Display", serif`,t.shadowBlur=8,t.fillText(`${d} ${c}`,50,h),t.textAlign="right",t.font=`${35.84}px "Noto Serif SC", serif`,t.fillText("乙巳年腊月",974,h),t.fillText("乙巳年腊月",974,h)};const g=targetHeight-60;t.textAlign="left",t.fillStyle="#FFFFFF",t.font=`${targetWidth*.02}px "Noto Serif SC", serif`,t.globalAlpha=.9,t.fillText("你的摩登关键词是",50,g-140),t.font=`bold ${targetWidth*.06}px "Noto Serif SC", serif`,t.globalAlpha=1,t.fillText(C,50,g-70),t.font=`italic ${targetWidth*.025}px serif`,t.fillStyle="#C5A065",t.fillText(`“${E}”`,50,g-20);const f=targetWidth*.55,x=targetHeight-320,l=targetWidth*.4/7,D=l*.9;t.textAlign="center",t.fillStyle="#FFFFFF",t.shadowBlur=2,t.font=`bold ${targetWidth*.018}px sans-serif`,t.globalAlpha=.7,["MON","TUE","WED","THU","FRI","SAT","SUN"].forEach((o,a)=>{t.fillText(o,f+a*l+l/2,x)}),t.globalAlpha=1,t.font=`${targetWidth*.02}px sans-serif`;const p={JANUARY:0,FEBRUARY:1,MARCH:2,APRIL:3,MAY:4,JUNE:5,JULY:6,AUGUST:7,SEPTEMBER:8,OCTOBER:9,NOVEMBER:10,DECEMBER:11}[(d||"JANUARY").toUpperCase()]||0,m=parseInt(c)||2026,R=(new Date(m,p,1).getDay()+6)%7,w=new Date(m,p+1,0).getDate();let n=1;for(let o=1;o<=6;o++){for(let a=0;a<7;a++)o===1&&a<R||n<=w&&(t.fillText(n.toString(),f+a*l+l/2,x+o*D),n++);if(n>w)break}T(i.toDataURL("image/png"))})};export{k as composeFinalImage};

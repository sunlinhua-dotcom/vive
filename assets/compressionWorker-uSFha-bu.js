(function(){"use strict";self.onmessage=async i=>{const{imageBitmap:a,quality:g,targetSize:l}=i.data;try{const o=new OffscreenCanvas(a.width,a.height);o.getContext("2d").drawImage(a,0,0);const n=2048;let e=a.width,t=a.height;if(e>n||t>n){const c=n/Math.max(e,t);e=Math.round(e*c),t=Math.round(t*c);const s=new OffscreenCanvas(e,t);s.getContext("2d").drawImage(a,0,0,e,t);const r=await(await s.convertToBlob({type:"image/jpeg",quality:.8})).arrayBuffer();self.postMessage({buffer:r,width:e,height:t,type:"image/jpeg"},[r])}else{const s=await(await o.convertToBlob({type:"image/jpeg",quality:.85})).arrayBuffer();self.postMessage({buffer:s,width:e,height:t,type:"image/jpeg"},[s])}}catch(o){self.postMessage({error:o.message})}}})();

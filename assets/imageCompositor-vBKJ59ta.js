import{_ as N}from"./index-NZ4lrOWb.js";const G=async(E,C)=>{const{month:h,year:d,keyword:R,attitude:H,logoColor:O="white"}=C;return new Promise((u,D)=>{const i=document.createElement("canvas"),t=i.getContext("2d"),o=new Image;o.crossOrigin="Anonymous",o.src=E,o.onload=async()=>{i.width=1024,i.height=1365,t.fillStyle="#1a1a1a",t.fillRect(0,0,1024,1365);const p=Math.max(1024/o.width,1365/o.height),w=o.width*p,m=o.height*p,T=(1024-w)/2,U=(1365-m)/2;t.drawImage(o,T,U,w,m);const s=t.createLinearGradient(0,965,0,1365);s.addColorStop(0,"transparent"),s.addColorStop(1,"rgba(0,0,0,0.9)"),t.fillStyle=s,t.fillRect(0,965,1024,400);const g=t.createLinearGradient(0,0,0,300);g.addColorStop(0,"rgba(0,0,0,0.8)"),g.addColorStop(1,"transparent"),t.fillStyle=g,t.fillRect(0,0,1024,300);const{processLogo:I}=await N(async()=>{const{processLogo:e}=await import("./logoProcessor-i7WsXgh7.js");return{processLogo:e}},[]),b=await I("/vive-logo-light.jpg",{threshold:230,targetColor:"white"}),r=new Image;if(r.crossOrigin="Anonymous",r.src=b,await new Promise(e=>{r.onload=e,r.onerror=e}),r.width>0){t.save();const e=i.width*.25,a=r.height*(e/r.width),Y=(i.width-e)/2,W=60;t.shadowColor="rgba(0,0,0,0.5)",t.shadowBlur=10,t.drawImage(r,Y,W,e,a),t.restore(),t.shadowColor="rgba(0,0,0,0.8)",t.shadowBlur=15,t.shadowOffsetY=5;const L=W+a/2;t.textAlign="left",t.fillStyle="#FFFFFF",t.textBaseline="middle",t.font=`${1024*.035}px "Playfair Display", serif`,t.shadowBlur=8,t.fillText(`${h} ${d}`,50,L)}const c=1305;t.textAlign="left",t.fillStyle="#FFFFFF",t.font=`${1024*.02}px "Noto Serif SC", serif`,t.globalAlpha=.9,t.fillText("你的摩登关键词是",50,c-140),t.font=`bold ${1024*.06}px "Noto Serif SC", serif`,t.globalAlpha=1,t.fillText(R,50,c-70),t.font=`italic ${1024*.025}px serif`,t.fillStyle="#C5A065",t.fillText(`“${H}”`,50,c-20);const y=1024*.55,x=1045,l=1024*.4/7,B=l*.9;t.textAlign="center",t.fillStyle="#FFFFFF",t.shadowBlur=2,t.font=`bold ${1024*.018}px sans-serif`,t.globalAlpha=.7,["MON","TUE","WED","THU","FRI","SAT","SUN"].forEach((e,a)=>{t.fillText(e,y+a*l+l/2,x)}),t.globalAlpha=1,t.font=`${1024*.02}px sans-serif`;const A={JANUARY:0,FEBRUARY:1,MARCH:2,APRIL:3,MAY:4,JUNE:5,JULY:6,AUGUST:7,SEPTEMBER:8,OCTOBER:9,NOVEMBER:10,DECEMBER:11}[(h||"JANUARY").toUpperCase()]||0,F=parseInt(d)||2026,M=(new Date(F,A,1).getDay()+6)%7,S=new Date(F,A+1,0).getDate();let n=1;for(let e=1;e<=6;e++){for(let a=0;a<7;a++)e===1&&a<M||n<=S&&(t.fillText(n.toString(),y+a*l+l/2,x+e*B),n++);if(n>S)break}u(i.toDataURL("image/jpeg",.9))},o.onerror=f=>D(f)})};export{G as composeFinalImage};

(function(){"use strict";self.onmessage=async c=>{try{const{file:t,maxWidth:f,quality:d}=c.data;if(!t)throw new Error("No file provided");const s=await createImageBitmap(t);let{width:e,height:r}=s;const o=f||1024;if(e>r?e>o&&(r=Math.round(r*o/e),e=o):r>o&&(e=Math.round(e*o/r),r=o),typeof OffscreenCanvas>"u")throw new Error("Browser does not support OffscreenCanvas");const i=new OffscreenCanvas(e,r),n=i.getContext("2d");n.imageSmoothingEnabled=!0,n.imageSmoothingQuality="high",n.drawImage(s,0,0,e,r);const l=await i.convertToBlob({type:"image/jpeg",quality:d||.7}),a=new FileReader;a.onload=()=>{self.postMessage({base64:a.result})},a.onerror=()=>{throw new Error("FileReader failed to create Data URL")},a.readAsDataURL(l)}catch(t){console.error("Worker Compression Error:",t),self.postMessage({error:t.message||"Unknown worker error"})}}})();

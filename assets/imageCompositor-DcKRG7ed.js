import{_ as L}from"./index-CiKz8CqW.js";const j=async(D,R)=>{const{month:x,year:S,keyword:I,attitude:T}=R;return new Promise(async(U,N)=>{try{await document.fonts.ready}catch(d){console.warn("Font loading timeout",d)}const i=document.createElement("canvas"),t=i.getContext("2d"),a=new Image;a.crossOrigin="Anonymous",a.src=D,a.onload=async()=>{i.width=1024,i.height=1365,t.fillStyle="#1a1a1a",t.fillRect(0,0,1024,1365);const y=Math.max(1024/a.width,1365/a.height),F=a.width*y,A=a.height*y,v=(1024-F)/2,B=(1365-A)/2;t.drawImage(a,v,B,F,A);const m=450,l=t.createLinearGradient(0,1365-m,0,1365);l.addColorStop(0,"rgba(0,0,0,0)"),l.addColorStop(.3,"rgba(0,0,0,0.1)"),l.addColorStop(.7,"rgba(0,0,0,0.6)"),l.addColorStop(1,"rgba(0,0,0,0.9)"),t.fillStyle=l,t.fillRect(0,1365-m,1024,m);const C=400,s=t.createLinearGradient(0,0,0,C);s.addColorStop(0,"rgba(0,0,0,0.7)"),s.addColorStop(.3,"rgba(0,0,0,0.4)"),s.addColorStop(.7,"rgba(0,0,0,0.1)"),s.addColorStop(1,"rgba(0,0,0,0)"),t.fillStyle=s,t.fillRect(0,0,1024,C);try{const e=document.createElement("canvas");e.width=100,e.height=100;const o=e.getContext("2d"),f=o.createImageData(100,100),n=new Uint32Array(f.data.buffer);for(let p=0;p<n.length;p++)Math.random()<.5?n[p]=134217728:n[p]=0;o.putImageData(f,0,0),t.save();const c=t.createPattern(e,"repeat");t.fillStyle=c,t.globalAlpha=.5,t.globalCompositeOperation="screen",t.fillRect(0,0,1024,1365*.4),t.restore()}catch(e){console.warn("Dither generation failed",e)}const{processLogo:M}=await L(async()=>{const{processLogo:e}=await import("./logoProcessor-i7WsXgh7.js");return{processLogo:e}},[]),$=await M("/vive-logo-light.jpg",{threshold:230,targetColor:"white"}),r=new Image;if(r.crossOrigin="Anonymous",r.src=$,await new Promise(e=>{r.onload=e,r.onerror=e}),r.width>0){const e=i.width*.25,o=r.height*(e/r.width),f=(i.width-e)/2,n=60,c=n+o/2;t.save(),t.globalAlpha=.08,t.textAlign="center",t.textBaseline="middle",t.font=`bold ${1024*.35}px "Noto Sans SC", "Source Han Sans CN", sans-serif`,t.fillStyle="#FFFFFF",t.scale(1,1.2),t.fillText("VIVE",1024/2,c/1.2),t.restore(),t.save(),t.shadowColor="rgba(0,0,0,0.5)",t.shadowBlur=10,t.drawImage(r,f,n,e,o),t.restore(),t.shadowColor="rgba(0,0,0,0.8)",t.shadowBlur=15,t.shadowOffsetY=5,t.textAlign="left",t.fillStyle="#FFFFFF",t.textBaseline="middle",t.font=`${1024*.035}px "Playfair Display", serif`,t.shadowBlur=8,t.fillText(`${x} ${S}`,50,c),t.textAlign="right",t.font=`500 ${1024*.035}px "Noto Serif SC", serif`,t.fillText("乙巳年腊月",974,c)}const w=1305;t.textAlign="left",t.fillStyle="#FFFFFF",t.font=`${1024*.02}px "Noto Serif SC", serif`,t.globalAlpha=.9,t.fillText("你的摩登关键词是",50,w-140),t.font=`bold ${1024*.06}px "Noto Serif SC", serif`,t.globalAlpha=1,t.fillText(I,50,w-70),t.font=`italic ${1024*.025}px serif`,t.fillStyle="#C5A065",t.fillText(`“${T}”`,50,w-20);const b=1024*.55,W=1045,g=1024*.4/7,O=g*.9;t.textAlign="center",t.fillStyle="#FFFFFF",t.shadowBlur=2,t.font=`bold ${1024*.018}px sans-serif`,t.globalAlpha=.7,["MON","TUE","WED","THU","FRI","SAT","SUN"].forEach((e,o)=>{t.fillText(e,b+o*g+g/2,W)}),t.globalAlpha=1,t.font=`${1024*.02}px sans-serif`;const u={JANUARY:0,FEBRUARY:1,MARCH:2,APRIL:3,MAY:4,JUNE:5,JULY:6,AUGUST:7,SEPTEMBER:8,OCTOBER:9,NOVEMBER:10,DECEMBER:11}[(x||"JANUARY").toUpperCase()]||0,E=parseInt(S)||2026,Y=(new Date(E,u,1).getDay()+6)%7,H=new Date(E,u+1,0).getDate();let h=1;for(let e=1;e<=6;e++){for(let o=0;o<7;o++)e===1&&o<Y||h<=H&&(t.fillText(h.toString(),b+o*g+g/2,W+e*O),h++);if(h>H)break}U(i.toDataURL("image/png"))},a.onerror=d=>N(d)})};export{j as composeFinalImage};

import{_ as P}from"./index-D8xSIwHs.js";const _=(p,m)=>{try{const i={JANUARY:0,FEBRUARY:1,MARCH:2,APRIL:3,MAY:4,JUNE:5,JULY:6,AUGUST:7,SEPTEMBER:8,OCTOBER:9,NOVEMBER:10,DECEMBER:11},s=parseInt(p)||new Date().getFullYear(),d=i[(m||"").toUpperCase()],w=d!==void 0?d:new Date().getMonth(),y=new Date(s,w,1),a=new Intl.DateTimeFormat("zh-CN",{calendar:"chinese",year:"numeric",month:"long"}).formatToParts(y),t=a.find(l=>l.type==="year")?.value||"",o=a.find(l=>l.type==="month")?.value||"";return t&&o?`${t}${o}`:"乙巳年腊月"}catch(i){return console.error("Lunar Date Error",i),"乙巳年腊月"}},z=async(p,m)=>{const{month:i,year:s,keyword:d,attitude:w}=m;return new Promise((y,S)=>{const a=document.createElement("canvas"),t=a.getContext("2d"),o=new Image;o.crossOrigin="Anonymous",o.src=p,o.onload=async()=>{a.width=1024,a.height=1365,t.fillStyle="#1a1a1a",t.fillRect(0,0,1024,1365);const u=Math.max(1024/o.width,1365/o.height),x=o.width*u,C=o.height*u,H=(1024-x)/2,I=(1365-C)/2;t.drawImage(o,H,I,x,C);const A=450,g=t.createLinearGradient(0,1365-A,0,1365);g.addColorStop(0,"rgba(0,0,0,0)"),g.addColorStop(.3,"rgba(0,0,0,0.1)"),g.addColorStop(.7,"rgba(0,0,0,0.6)"),g.addColorStop(1,"rgba(0,0,0,0.9)"),t.fillStyle=g,t.fillRect(0,1365-A,1024,A),t.save(),t.globalCompositeOperation="source-over";const R=150,h=t.createLinearGradient(0,0,0,R);h.addColorStop(0,"rgba(0,0,0,0.25)"),h.addColorStop(.3,"rgba(0,0,0,0.1)"),h.addColorStop(1,"rgba(0,0,0,0)"),t.fillStyle=h,t.fillRect(0,0,1024,R),t.restore();const{processLogo:Y}=await P(async()=>{const{processLogo:e}=await import("./logoProcessor-i7WsXgh7.js");return{processLogo:e}},[]),B=await Y("/vive-logo-light.jpg",{threshold:230,targetColor:"white"}),n=new Image;if(n.crossOrigin="Anonymous",n.src=B,await new Promise(e=>{n.onload=e,n.onerror=e}),n.width>0){t.save();const e=a.width*.25,r=n.height*(e/n.width),O=(a.width-e)/2,T=60;t.shadowColor="rgba(0,0,0,0.5)",t.shadowBlur=10,t.drawImage(n,O,T,e,r),t.restore();const b=T+r/2,$="#FFFFFF";t.fillStyle=$,t.shadowColor="rgba(0,0,0,0.6)",t.shadowBlur=8,t.textBaseline="middle",t.textAlign="left",t.font=`${1024*.035}px "Playfair Display", serif`,t.fillText(`${i} ${s}`,50,b),t.textAlign="right",t.font=`${1024*.035}px "Noto Serif SC", serif`;const v=_(s,i);t.fillText(v,974,b)}t.restore();const E=1305;t.textAlign="left",t.fillStyle="#FFFFFF",t.font=`${1024*.02}px "Noto Serif SC", serif`,t.globalAlpha=.9,t.fillText("你的摩登关键词是",50,E-140),t.font=`bold ${1024*.06}px "Noto Serif SC", serif`,t.globalAlpha=1,t.fillText(d,50,E-70),t.font=`italic ${1024*.025}px serif`,t.fillStyle="#C5A065",t.fillText(`“${w}”`,50,E-20);const F=1024*.55,D=1045,c=1024*.4/7,N=c*.9;t.textAlign="center",t.fillStyle="#FFFFFF",t.shadowBlur=2,t.font=`bold ${1024*.018}px sans-serif`,t.globalAlpha=.7,["MON","TUE","WED","THU","FRI","SAT","SUN"].forEach((e,r)=>{t.fillText(e,F+r*c+c/2,D)}),t.globalAlpha=1,t.font=`${1024*.02}px sans-serif`;const W={JANUARY:0,FEBRUARY:1,MARCH:2,APRIL:3,MAY:4,JUNE:5,JULY:6,AUGUST:7,SEPTEMBER:8,OCTOBER:9,NOVEMBER:10,DECEMBER:11}[(i||"JANUARY").toUpperCase()]||0,U=parseInt(s)||2026,L=(new Date(U,W,1).getDay()+6)%7,M=new Date(U,W+1,0).getDate();let f=1;for(let e=1;e<=6;e++){for(let r=0;r<7;r++)e===1&&r<L||f<=M&&(t.fillText(f.toString(),F+r*c+c/2,D+e*N),f++);if(f>M)break}y(a.toDataURL("image/jpeg",.9))},o.onerror=l=>S(l)})};export{z as composeFinalImage};

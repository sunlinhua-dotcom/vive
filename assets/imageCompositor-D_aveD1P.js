import{_ as L}from"./index-dzb56thY.js";const j=async(H,R)=>{const{month:y,year:S,keyword:I,attitude:T}=R;return new Promise(async(U,N)=>{try{await document.fonts.ready}catch(c){console.warn("Font loading timeout",c)}const i=document.createElement("canvas"),t=i.getContext("2d"),a=new Image;a.crossOrigin="Anonymous",a.src=H,a.onload=async()=>{i.width=1024,i.height=1365,t.fillStyle="#1a1a1a",t.fillRect(0,0,1024,1365);const F=Math.max(1024/a.width,1365/a.height),A=a.width*F,C=a.height*F,v=(1024-A)/2,B=(1365-C)/2;t.drawImage(a,v,B,A,C);const p=450,l=t.createLinearGradient(0,1365-p,0,1365);l.addColorStop(0,"rgba(0,0,0,0)"),l.addColorStop(.3,"rgba(0,0,0,0.1)"),l.addColorStop(.7,"rgba(0,0,0,0.6)"),l.addColorStop(1,"rgba(0,0,0,0.9)"),t.fillStyle=l,t.fillRect(0,1365-p,1024,p);const m=200,w=t.createLinearGradient(0,0,0,m);w.addColorStop(0,"rgba(0,0,0,0.6)"),w.addColorStop(1,"rgba(0,0,0,0)"),t.fillStyle=w,t.fillRect(0,0,1024,m);try{const e=document.createElement("canvas");e.width=100,e.height=100;const o=e.getContext("2d"),h=o.createImageData(100,100),n=new Uint32Array(h.data.buffer);for(let f=0;f<n.length;f++)Math.random()<.5?n[f]=134217728:n[f]=0;o.putImageData(h,0,0),t.save();const g=t.createPattern(e,"repeat");t.fillStyle=g,t.globalAlpha=.5,t.globalCompositeOperation="screen",t.fillRect(0,0,1024,m),t.restore()}catch(e){console.warn("Dither generation failed",e)}const{processLogo:M}=await L(async()=>{const{processLogo:e}=await import("./logoProcessor-i7WsXgh7.js");return{processLogo:e}},[]),$=await M("/vive-logo-light.jpg",{threshold:230,targetColor:"white"}),r=new Image;if(r.crossOrigin="Anonymous",r.src=$,await new Promise(e=>{r.onload=e,r.onerror=e}),r.width>0){const e=i.width*.25,o=r.height*(e/r.width),h=(i.width-e)/2,n=60,g=n+o/2;t.save(),t.globalAlpha=.08,t.textAlign="center",t.textBaseline="middle",t.font=`bold ${1024*.35}px "Noto Sans SC", "Source Han Sans CN", sans-serif`,t.fillStyle="#FFFFFF",t.scale(1,1.2),t.fillText("VIVE",1024/2,g/1.2),t.restore(),t.save(),t.shadowColor="rgba(0,0,0,0.5)",t.shadowBlur=10,t.drawImage(r,h,n,e,o),t.restore(),t.shadowColor="rgba(0,0,0,0.8)",t.shadowBlur=15,t.shadowOffsetY=5,t.textAlign="left",t.fillStyle="#FFFFFF",t.textBaseline="middle",t.font=`${1024*.035}px "Playfair Display", serif`,t.shadowBlur=8,t.fillText(`${y} ${S}`,50,g),t.textAlign="right",t.font=`500 ${1024*.035}px "Noto Serif SC", serif`,t.fillText("乙巳年腊月",974,g)}const x=1305;t.textAlign="left",t.fillStyle="#FFFFFF",t.font=`${1024*.02}px "Noto Serif SC", serif`,t.globalAlpha=.9,t.fillText("你的摩登关键词是",50,x-140),t.font=`bold ${1024*.06}px "Noto Serif SC", serif`,t.globalAlpha=1,t.fillText(I,50,x-70),t.font=`italic ${1024*.025}px serif`,t.fillStyle="#C5A065",t.fillText(`“${T}”`,50,x-20);const W=1024*.55,b=1045,s=1024*.4/7,O=s*.9;t.textAlign="center",t.fillStyle="#FFFFFF",t.shadowBlur=2,t.font=`bold ${1024*.018}px sans-serif`,t.globalAlpha=.7,["MON","TUE","WED","THU","FRI","SAT","SUN"].forEach((e,o)=>{t.fillText(e,W+o*s+s/2,b)}),t.globalAlpha=1,t.font=`${1024*.02}px sans-serif`;const u={JANUARY:0,FEBRUARY:1,MARCH:2,APRIL:3,MAY:4,JUNE:5,JULY:6,AUGUST:7,SEPTEMBER:8,OCTOBER:9,NOVEMBER:10,DECEMBER:11}[(y||"JANUARY").toUpperCase()]||0,E=parseInt(S)||2026,Y=(new Date(E,u,1).getDay()+6)%7,D=new Date(E,u+1,0).getDate();let d=1;for(let e=1;e<=6;e++){for(let o=0;o<7;o++)e===1&&o<Y||d<=D&&(t.fillText(d.toString(),W+o*s+s/2,b+e*O),d++);if(d>D)break}U(i.toDataURL("image/png"))},a.onerror=c=>N(c)})};export{j as composeFinalImage};

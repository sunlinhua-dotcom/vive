import{_ as O}from"./index-DFSZsJ2z.js";const V=async(H,u)=>{const{month:p,year:w,keyword:R,attitude:T}=u;return new Promise(async(D,I)=>{try{await document.fonts.ready}catch(s){console.warn("Font loading timeout",s)}const i=document.createElement("canvas"),t=i.getContext("2d"),o=new Image;o.crossOrigin="Anonymous",o.src=H,o.onload=async()=>{i.width=1024,i.height=1365,t.fillStyle="#1a1a1a",t.fillRect(0,0,1024,1365);const x=Math.max(1024/o.width,1365/o.height),m=o.width*x,S=o.height*x,U=(1024-m)/2,N=(1365-S)/2;t.drawImage(o,U,N,m,S);const d=450,l=t.createLinearGradient(0,1365-d,0,1365);l.addColorStop(0,"rgba(0,0,0,0)"),l.addColorStop(.3,"rgba(0,0,0,0.1)"),l.addColorStop(.7,"rgba(0,0,0,0.6)"),l.addColorStop(1,"rgba(0,0,0,0.9)"),t.fillStyle=l,t.fillRect(0,1365-d,1024,d);const F=200,c=t.createLinearGradient(0,0,0,F);c.addColorStop(0,"rgba(0,0,0,0.6)"),c.addColorStop(1,"rgba(0,0,0,0)"),t.fillStyle=c,t.fillRect(0,0,1024,F);const{processLogo:B}=await O(async()=>{const{processLogo:e}=await import("./logoProcessor-i7WsXgh7.js");return{processLogo:e}},[]),$=await B("/vive-logo-light.jpg",{threshold:230,targetColor:"white"}),r=new Image;if(r.crossOrigin="Anonymous",r.src=$,await new Promise(e=>{r.onload=e,r.onerror=e}),r.width>0){t.save(),t.globalAlpha=.08,t.textAlign="center",t.textBaseline="middle",t.font=`bold ${1024*.35}px "Noto Sans SC", "Source Han Sans CN", sans-serif`,t.fillStyle="#FFFFFF",t.scale(1,1.2),t.fillText("VIVE",1024/2,80),t.restore(),t.save();const e=i.width*.25,a=r.height*(e/r.width),L=(i.width-e)/2,E=60;t.shadowColor="rgba(0,0,0,0.5)",t.shadowBlur=10,t.drawImage(r,L,E,e,a),t.restore(),t.shadowColor="rgba(0,0,0,0.8)",t.shadowBlur=15,t.shadowOffsetY=5;const f=E+a/2;t.textAlign="left",t.fillStyle="#FFFFFF",t.textBaseline="middle",t.font=`${1024*.035}px "Playfair Display", serif`,t.shadowBlur=8,t.fillText(`${p} ${w}`,50,f),t.textAlign="right",t.font=`${1024*.035}px "Noto Serif SC", serif`,t.fillText("乙巳年腊月",974,f),t.fillText("乙巳年腊月",974,f)}const h=1305;t.textAlign="left",t.fillStyle="#FFFFFF",t.font=`${1024*.02}px "Noto Serif SC", serif`,t.globalAlpha=.9,t.fillText("你的摩登关键词是",50,h-140),t.font=`bold ${1024*.06}px "Noto Serif SC", serif`,t.globalAlpha=1,t.fillText(R,50,h-70),t.font=`italic ${1024*.025}px serif`,t.fillStyle="#C5A065",t.fillText(`“${T}”`,50,h-20);const y=1024*.55,A=1045,n=1024*.4/7,M=n*.9;t.textAlign="center",t.fillStyle="#FFFFFF",t.shadowBlur=2,t.font=`bold ${1024*.018}px sans-serif`,t.globalAlpha=.7,["MON","TUE","WED","THU","FRI","SAT","SUN"].forEach((e,a)=>{t.fillText(e,y+a*n+n/2,A)}),t.globalAlpha=1,t.font=`${1024*.02}px sans-serif`;const W={JANUARY:0,FEBRUARY:1,MARCH:2,APRIL:3,MAY:4,JUNE:5,JULY:6,AUGUST:7,SEPTEMBER:8,OCTOBER:9,NOVEMBER:10,DECEMBER:11}[(p||"JANUARY").toUpperCase()]||0,C=parseInt(w)||2026,Y=(new Date(C,W,1).getDay()+6)%7,b=new Date(C,W+1,0).getDate();let g=1;for(let e=1;e<=6;e++){for(let a=0;a<7;a++)e===1&&a<Y||g<=b&&(t.fillText(g.toString(),y+a*n+n/2,A+e*M),g++);if(g>b)break}D(i.toDataURL("image/png"))},o.onerror=s=>I(s)})};export{V as composeFinalImage};
